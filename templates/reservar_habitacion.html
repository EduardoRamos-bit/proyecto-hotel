<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reservar Habitación</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-light d-flex align-items-center justify-content-center vh-100">

<div class="container">
  <div class="card shadow-lg p-4 rounded-4 mx-auto" style="max-width: 500px;">
    <h2 class="text-center text-primary mb-4">Reservar Habitación</h2>

    <form method="post">
      <!-- Fecha Entrada -->
      <div class="mb-3">
        <label for="fecha_entrada" class="form-label">Fecha Entrada</label>
        <input type="date" id="fecha_entrada" name="fecha_entrada" class="form-control"
               value="{{ request.form.fecha_entrada or '' }}" required>
      </div>

      <!-- Fecha Salida -->
      <div class="mb-3">
        <label for="fecha_salida" class="form-label">Fecha Salida</label>
        <input type="date" id="fecha_salida" name="fecha_salida" class="form-control"
               value="{{ request.form.fecha_salida or '' }}" required>
      </div>

      {% if habitaciones %}
      <!-- Selección de Habitación -->
      <div class="mb-3">
        <label for="habitacion" class="form-label">Habitación</label>
        <select id="habitacion" name="habitacion" class="form-select" required>
          {% for hab in habitaciones %}
            <option value="{{ hab.id }}" data-precio="{{ hab.precio_por_noche }}">
              {{ hab.numero_habitacion }} - {{ hab.tipo }} - ${{ hab.precio_por_noche }}
            </option>
          {% endfor %}
        </select>
      </div>

      <!-- Método de Pago -->
      <div class="mb-3">
        <label for="metodo_pago" class="form-label">Método de Pago</label>
        <select id="metodo_pago" name="metodo_pago" class="form-select" required>
          <option value="" disabled selected>Seleccione un método</option>
          <option value="efectivo">Efectivo</option>
          <option value="tarjeta">Tarjeta</option>
          <option value="transferencia">Transferencia</option>
        </select>
      </div>

      <!-- Cantidad de días -->
      <div class="mb-3">
        <label class="form-label">Cantidad de Días</label>
        <input type="text" id="dias" class="form-control" readonly>
      </div>

      <!-- Monto -->
      <div class="mb-3">
        <label for="monto" class="form-label">Monto a Pagar</label>
        <input type="number" id="monto" name="monto" class="form-control" step="0.01" min="0" readonly required>
      </div>

      <!-- Botón de Reservar -->
      <div class="d-grid">
        <button type="submit" class="btn btn-primary">Reservar</button>
      </div>

      {% else %}
      <!-- Buscar habitaciones disponibles -->
      <div class="d-grid">
        <button type="submit" class="btn btn-secondary">Buscar habitaciones disponibles</button>
      </div>
      {% endif %}
    </form>

    {% if error %}
    <div class="alert alert-danger mt-3 text-center">
      {{ error }}
    </div>
    {% endif %}
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
function calcularMonto() {
    const entrada = document.getElementById("fecha_entrada").value;
    const salida = document.getElementById("fecha_salida").value;
    const hab = document.getElementById("habitacion");
    const precio = hab?.options[hab.selectedIndex]?.dataset.precio || 0;

    if (entrada && salida) {
        const dias = (new Date(salida) - new Date(entrada)) / (1000*60*60*24);
        if (dias > 0) {
            document.getElementById("dias").value = dias;
            document.getElementById("monto").value = dias * precio;
        } else {
            document.getElementById("dias").value = "";
            document.getElementById("monto").value = "";
        }
    }
}

document.getElementById("fecha_entrada").addEventListener("change", calcularMonto);
document.getElementById("fecha_salida").addEventListener("change", calcularMonto);
document.getElementById("habitacion")?.addEventListener("change", calcularMonto);
</script>
</body>
</html>

